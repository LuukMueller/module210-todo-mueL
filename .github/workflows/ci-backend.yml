name: Build and push Docker image to private registry

on:
  push:
    branches:
      - main  # Trigger auf 'main' Branch

env:
  REG_NAME: "exo.container-registry.com"  # Die Registry URL
  IMAGE_NAME: "todo-app"  # Der Name des Docker-Images
  REGISTRY: "${REG_NAME}/c213-emf"  # Das Repository innerhalb der Registry
  TAG_NAME: "MUL"  # Der Tag für das Image

jobs:
  build-and-push:
    runs-on: ubuntu-latest  # Build auf einer Ubuntu VM

    steps:
      # Schritt 1: Code aus dem Repository auschecken
      - name: Checkout repository
        uses: actions/checkout@v3

      # Schritt 2: Anmeldung bei der privaten Docker-Registry
      - name: Log in to Docker registry
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}  # Dein Benutzername für das Registry
          password: ${{ secrets.DOCKER_PASSWORD }}  # Dein Token oder Passwort für das Registry

      # Schritt 3: Docker-Image bauen
      - name: Build Docker image
        run: |
          docker build -t $REGISTRY/$IMAGE_NAME:$TAG_NAME .

      # Schritt 4: Docker-Image in die private Registry pushen
      - name: Push Docker image
        run: |
          docker push $REGISTRY/$IMAGE_NAME:$TAG_NAME
